This repo contains documentation for the Procedural Rock Generator Tool in Houdini. There is no code associated due to Houdini's node network structure.

# Procedural Rock Generator 
The Procedural Rock Generator allows a user to input a base shape to create procedural rock structures. Artists can edit multiple
properties including target polygon counts, number of pieces created, and several noise settings. The tool creates both a high poly and a
low poly version of the assets. The details of the high poly asset are exported as a normal map and can be applied to the low poly asset
which has autogenerated UVs. The HDA can also be linked to a TOPS network for easy export. 

Features include:
* Create a rock model from any input base shape
* Edit rock properties including target polycount, number of pieces, piece height ramp, and more
* Edit noise settings such as frequency, amplitude, and offset to get the perfect look
* Autogenerate uv maps for low poly assets and normal maps for high poly assets
* Export options auto center pivot and rotate for easy import into Unreal Engine 5

![materialId.gif](imgs/materialIdDemo.gif)

## Asset Workflow
The basic worflow for the using the tool in Houdini to importing assets in Unreal Engine is as follows:
1. Create or import a base shape mesh into Houdini
2. Connect base mesh to the Rock Genreator HDA node
3. Edit any parameters as neccessary according to art direction
4. HDA will output 2 meshes - high poly and low poly (low poly has autogenerated UV maps)
5. Export meshes (Noncommercial Houdini only allows .obj format)
6. Export a normal map from the high poly (this can be done through Houdini Labs Maps Baker node if not noncommercial version)
7. Import low poly mesh into Unreal Engine (or both meshes if wanted)
8. Apply materials and normal maps to low poly mesh

## Base Meshes
Base meshes can be very simple. The tool measures height data by creating a silhouette grid on the ground plane and measuring the ray distance between the grid and the original mesh.
A mask attribute is then created with minimum and maximums set by the height data. This mask attribute controls the height of each piece when it is polyextruded upwards. 
This attribute can be controlled by the artist via a ramp parameter. This allows for different height data trends, such as linearly going from minimum height to maximum height, 
creating sharp contrasts between min and max height, or favoring one end of the spectrum (more taller heights vs more shorter heights). 

![materialId.gif](imgs/materialIdDemo.gif)

## Tool workflow
The basic workflow of how the tool works is as follows:
1. Connect input shape
2. Create silhouette of base shape and move silhouette to ground plane
3. Scatter points onto grid (number of points = number of pieces that will make up the final rock)
4. Voronoi fracture based on the scattered points
5. Add noise for variation of piece outlines
6. Ray grid to base shape outline to get min distance and max distance attributes
7. Create mask attribute based on the min and max distances
8. For Each Connected Piece Loop 
  - Random rotate to create variety
  - Random scale to create variety
  - Voronoi fracture to create rock like cracks and blocks in the final shape
  - Delete small prims to ensure mesh integrity
  - PolyExtrude based on mask attribute
9. Mountain node to create variation in overall shape
10. VDB -> Convert VDB to smooth out intersections
11. VDB Fog volume -> Convert VDB
  - 3 Volume Vops containing different noise volumes for large details
12. Noise via attribute vops to create large and small rough patches (cuts) into rock 
13. Delete small parts to ensure rock integrity
14. Move mesh to center and rotate z up to prepare for export to Unreal (these steps can be turned off via a parameter)
15. Normal node
16. HIGH RES OUT
17. Remesh with target polygon count as a parameter
18. Auto UV
19. Normal node
20. LOW RES OUT
